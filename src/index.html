<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gitody - GitHub Repository Manager</title>
    <link rel="stylesheet" href="./styles/main.css">
    <style>
        :root { --bg:#0d1117; --border:#30363d; --text:#c9d1d9; --accent:#58a6ff; --danger:#f85149; }
        body { background:var(--bg); color:var(--text); font-family:sans-serif; margin:0; overflow:hidden; }
        .container { display:flex; height:100vh; }
        .sidebar { width:260px; border-right:1px solid var(--border); padding:15px; overflow-y:auto; background:#161b22; }
        .main-content { flex:1; display:flex; flex-direction:column; background:var(--bg); }
        .top-header { height:60px; border-bottom:1px solid var(--border); display:flex; align-items:center; padding:0 20px; background:#161b22; z-index:10; }
        .logo { font-weight:bold; font-size:20px; color:var(--accent); }
        .user-avatar { width:32px; height:32px; border-radius:50%; background:var(--border); margin-left:20px; overflow:hidden; display:flex; align-items:center; justify-content:center; }
        .user-avatar img { width:100%; height:100%; object-fit:cover; }
        
        .github-panel { display:flex; flex:1; overflow:hidden; }
        .github-nav-icons { width:60px; border-right:1px solid var(--border); display:flex; flex-direction:column; align-items:center; padding-top:20px; gap:20px; background:#0d1117; }
        .github-icon-btn { cursor:pointer; background:none; border:none; color:#8b949e; font-size:18px; width:40px; height:40px; border-radius:8px; display:flex; align-items:center; justify-content:center; transition:0.2s; }
        .github-icon-btn:hover { background:#21262d; color:#fff; }
        .github-icon-btn.active { color:var(--accent); background:#161b22; }
        
        .github-content { flex:1; padding:20px; overflow-y:auto; }
        .github-section { display:none; }
        .github-section.active { display:block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
        
        .card { background:#161b22; border:1px solid var(--border); padding:15px; border-radius:8px; margin-bottom:12px; }
        .sidebar-item { padding:10px; cursor:pointer; border-radius:6px; margin-bottom:4px; transition:0.2s; font-size:14px; }
        .sidebar-item:hover { background:#21262d; }
        .sidebar-item.active { background:rgba(88,166,255,0.1); color:var(--accent); border:1px solid var(--accent); }
        
        .modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:2000; backdrop-filter:blur(8px); display:none; align-items:center; justify-content:center; }
        .modal.active { display:flex !important; }
        .modal-content { background:#161b22; border:1px solid var(--border); border-radius:12px; width:550px; padding:40px; position:relative; box-shadow:0 20px 50px rgba(0,0,0,0.6); transform-origin:center; }
        
        /* Profile Expand Animation */
        .profile-modal-content { animation: profileReveal 0.7s cubic-bezier(0.19, 1, 0.22, 1) forwards; }
        @keyframes profileReveal {
            0% { transform: scaleX(0) scaleY(0.002); opacity: 0; }
            40% { transform: scaleX(1) scaleY(0.002); opacity: 1; }
            100% { transform: scaleX(1) scaleY(1); opacity: 1; }
        }

        .btn { background:var(--accent); border:none; color:#fff; padding:8px 16px; border-radius:6px; cursor:pointer; font-weight:600; transition:0.2s; }
        .btn:hover { opacity:0.8; }
        .btn-primary { background:#238636; }
        .btn-danger { background:var(--danger); }
        .btn-sm { padding:4px 8px; font-size:12px; }
        
        .form-input { background:#0d1117; border:1px solid var(--border); color:#fff; padding:8px 12px; border-radius:6px; width:100%; box-sizing:border-box; margin-bottom:10px; }
        .profile-label { display: block; font-size: 11px; color: #8b949e; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; font-weight: 600; }
        pre { background:#0d1117; padding:15px; border-radius:8px; border:1px solid var(--border); font-family:monospace; overflow:auto; }
        .connect-check { color:#3fb950; margin-left:10px; font-weight:bold; display:none; }
        .connect-check.visible { display:inline; }
        .modal-close { position: absolute; top: 20px; right: 20px; background: none; border: none; color: #8b949e; font-size: 24px; cursor: pointer; transition: 0.2s; }
        .modal-close:hover { color: #f85149; transform: rotate(90deg); }
    </style>
</head>

<body>
    <div class="top-header">
        <div class="logo">Gitody</div>
        <div id="userAvatarBtn" class="user-avatar">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 8a3 3 0 100-6 3 3 0 000 6zm0 2c-2.67 0-8 1.34-8 4v1h16v-1c0-2.66-5.33-4-8-4z"/></svg>
        </div>
        <div id="connectCheck" class="connect-check">‚úì Connected</div>
        <div id="headerTitle" style="margin-left:auto; font-weight:600; color:#8b949e">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π</div>
        <button class="btn btn-sm" onclick="showModal('github-connect')" style="margin-left:20px">Login</button>
    </div>

    <!-- GitHub Login Modal -->
    <div id="github-connectModal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('github-connect')">‚úï</button>
            <h3 style="margin:0 0 20px 0">GitHub Authorization</h3>
            <button class="btn" onclick="connectGitHubOAuth()" style="width:100%; margin-bottom:15px">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Chrome</button>
            <div style="text-align:center; margin-bottom:15px; color:#8b949e">–∏–ª–∏ —á–µ—Ä–µ–∑ —Ç–æ–∫–µ–Ω</div>
            <input type="password" id="githubTokenInput" class="form-input" placeholder="Personal Access Token">
            <button class="btn btn-primary" onclick="connectGitHub()" style="width:100%">–ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ç–æ–∫–µ–Ω</button>
            <div id="githubConnectStatus" style="margin-top:10px; text-align:center; font-size:12px"></div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content profile-modal-content">
            <button class="modal-close" onclick="closeModal('profile')">‚úï</button>
            <div id="profileContent">
                <div style="text-align: center; color: #8b949e;">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è...</div>
            </div>
        </div>
    </div>

    <!-- Monaco Editor Loader -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>

    <div class="container">
        <!-- Sidebar (Shared or specific to GitHub?) -->
        <!-- We keep sidebar here, but it might need to be inside GitHub tab if it's specific. 
             However, repoManager controls it. Let's keep it global for now or hide it via CSS when not in GitHub/Editor. -->
        <aside class="sidebar" id="mainSidebar">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px">
                <h4 style="margin:0">Repositories</h4>
                <div style="display:flex; gap:5px;">
                    <button class="btn btn-sm btn-primary" onclick="githubManager.promptCreateRepo()" title="New Repo">+</button>
                    <button class="btn btn-sm" onclick="githubManager.openLocalRepo()" title="Local Repo" style="background:#30363d">üìÇ</button>
                    <button class="btn btn-sm" onclick="githubManager.importRepo()" title="Import" style="background:#30363d">üì•</button>
                </div>
            </div>
            <div id="repoList"></div>
            <div id="fileStructure" class="file-structure" style="display:flex; flex-direction:column; flex:1; margin-top:20px; border-top:1px solid #30363d; padding-top:10px;">
                <div class="file-structure-header" style="margin-bottom:10px; font-size:12px; font-weight:600; color:#8b949e;">FILES</div>
                <div id="repoFileTree" class="file-tree"></div>
            </div>
        </aside>

        <!-- Main content -->
        <main class="main-content">
            <div id="sync-info" style="font-size:10px; color:#8b949e; text-align:right; padding:5px 20px 0 0; height:15px"></div>
            
            <!-- TAB: GitHub -->
            <div id="github" class="tab-content active" style="height:100%; display:none;">
                <div class="github-panel" style="height:100%;">
                    <nav class="github-nav-icons">
                        <button class="github-icon-btn active" data-section="overview" title="Contents">üìÅ</button>
                        <button class="github-icon-btn" data-section="branches" title="Branches">üåø</button>
                        <button class="github-icon-btn" data-section="pullrequests" title="PRs">üîÄ</button>
                        <button class="github-icon-btn" data-section="issues" title="Issues">‚ùó</button>
                        <button class="github-icon-btn" data-section="commits" title="Commits">üïí</button>
                        <button class="github-icon-btn" data-section="actions" title="Actions">‚ö°</button>
                        <button class="github-icon-btn" data-section="releases" title="Releases">üì¶</button>
                        <button class="github-icon-btn" data-section="settings" title="Information & Settings">‚öôÔ∏è</button>
                    </nav>

                    <div class="github-content">
                        <!-- Overview -->
                        <div id="section-overview" class="github-section active">
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px">
                                <h3 style="margin:0">Overview</h3>
                                <button class="btn btn-sm" onclick="githubManager.syncAll()" title="–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë">‚Üª Refresh</button>
                            </div>
                            <!-- Files are now in sidebar, this can be a dashboard or readme preview -->
                            <div id="readmePreview" style="padding:20px; background:#0d1117; border-radius:8px; border:1px solid #30363d;">
                                Select a file in the sidebar to edit.
                            </div>
                            
                            <div id="codePreview" style="display:none; margin-top:20px">
                                <h4 id="previewFileName"></h4>
                                <textarea id="previewContent" class="form-input" style="height:300px; font-family:monospace; background:#0d1117;"></textarea>
                                <div style="display:flex; gap:10px; margin-top:10px;">
                                    <button class="btn btn-sm btn-primary" onclick="githubManager.applyEditedChanges()">Apply Changes</button>
                                    <button class="btn btn-sm" onclick="githubManager.closePreview()">Close</button>
                                </div>
                            </div>
                        </div>

                        <!-- Branches -->
                        <div id="section-branches" class="github-section">
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px">
                                <h3>Branches</h3>
                                <button class="btn btn-sm btn-primary" onclick="githubManager.promptCreateBranch()">+ New Branch</button>
                            </div>
                            <div id="branchesList"></div>
                        </div>

                        <!-- PRs -->
                        <div id="section-pullrequests" class="github-section"><h3>PRs</h3><div id="prList"></div></div>

                        <!-- Issues -->
                        <div id="section-issues" class="github-section">
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px">
                                <h3>Issues</h3>
                                <button class="btn btn-sm btn-primary" onclick="githubManager.promptCreateIssue()">+ New Issue</button>
                            </div>
                            <div id="issuesList"></div>
                        </div>

                        <!-- Commits -->
                        <div id="section-commits" class="github-section">
                            <h3>Commits History</h3>
                            <div id="commitsList"></div>
                        </div>

                        <!-- Actions -->
                        <div id="section-actions" class="github-section"><h3>Workflows</h3><div id="actionsList"></div></div>

                        <!-- Releases -->
                        <div id="section-releases" class="github-section"><h3>Releases</h3><div id="releasesList"></div></div>

                        <!-- Settings -->
                        <div id="section-settings" class="github-section">
                            <h3>Repository Information & Settings</h3>
                            <div id="repoInfoPage">
                                <div style="text-align:center; padding:100px 0; color:#8b949e;">
                                    <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π</h2>
                                    <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã –¥–µ—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: Editor (Monaco) -->
            <div id="editor" class="tab-content" style="height:100%; display:none; flex-direction:column;">
                <div class="editor-tabs" id="editorTabs">
                    <!-- Tabs injected here -->
                </div>
                <div id="monaco-editor-container" style="flex:1; width:100%;"></div>
                <div class="editor-status-bar">
                    <div id="editorLang">Plain Text</div>
                    <div id="editorCursor">Ln 1, Col 1</div>
                </div>
            </div>

            <!-- Other Tabs Placeholders -->
            <div id="dashboard" class="tab-content" style="display:none; padding:20px;"><h2>Dashboard</h2></div>
            <div id="chat" class="tab-content" style="display:none; padding:20px;"><h2>AI Chat</h2></div>
            <div id="network" class="tab-content" style="display:none; height:100%; overflow-y:auto; padding:20px;">
                <div class="network-dashboard">
                    <div class="network-header">
                        <h2>Network Monitor & VPN</h2>
                        <div class="net-speeds">
                            <div class="speed-box down">‚Üì <span id="net-download">0 KB/s</span></div>
                            <div class="speed-box up">‚Üë <span id="net-upload">0 KB/s</span></div>
                        </div>
                    </div>
                    
                    <div class="network-grid">
                        <!-- Traffic Graph -->
                        <div class="card net-card full">
                            <h3>Real-time Traffic</h3>
                            <canvas id="network-graph-canvas" style="width:100%; height:200px;"></canvas>
                        </div>

                        <!-- Interfaces -->
                        <div class="card net-card">
                            <h3>Interfaces</h3>
                            <div id="net-interfaces" class="net-list"></div>
                        </div>

                        <!-- VPN Manager -->
                        <div class="card net-card">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <h3>VPN Connections</h3>
                                <button class="btn btn-sm btn-primary" onclick="networkManager.addNewVpn()">+ Add</button>
                            </div>
                            <div id="vpn-list" class="net-list"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="settings" class="tab-content" style="display:none; padding:20px;">
                <h2>System & Settings</h2>
                <div class="settings-container">
                    <div class="settings-sidebar">
                        <button class="settings-icon-btn active" data-section="system">üíª System</button>
                        <button class="settings-icon-btn" data-section="network" onclick="navRing.setActiveTab('network')">üåê Network</button>
                    </div>
                    <div class="settings-content">
                        <div id="settings-system" class="settings-section active">
                            <!-- System Monitor Cards injected here -->
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <!-- Floating Arc Navigation -->
    <div class="nav-arc" id="navArc">
        <button class="nav-arc-item" data-tab="dashboard" data-index="0" title="Dashboard">üè†</button>
        <button class="nav-arc-item active" data-tab="github" data-index="1" title="GitHub">üê±</button>
        <button class="nav-arc-item" data-tab="chat" data-index="2" title="AI Chat">ü§ñ</button>
        <button class="nav-arc-item" data-tab="editor" data-index="3" title="Code Editor">üìù</button>
        <button class="nav-arc-item" data-tab="network" data-index="4" title="Network & VPN">üåê</button>
        <button class="nav-arc-item" data-tab="settings" data-index="5" title="System">üíª</button>
    </div>

    <style>
        .tab-content.active { display: flex !important; }
        .editor-tabs { display: flex; background: #0d1117; border-bottom: 1px solid #30363d; overflow-x: auto; }
        .editor-tab { padding: 8px 12px; cursor: pointer; color: #8b949e; border-right: 1px solid #30363d; display: flex; align-items: center; gap: 8px; font-size: 12px; }
        .editor-tab.active { background: #161b22; color: #c9d1d9; border-top: 2px solid #58a6ff; }
        .editor-tab:hover { background: #161b22; }
        .editor-tab-close { opacity: 0.5; font-size: 14px; }
        .editor-tab-close:hover { opacity: 1; color: #f85149; }
        .file-structure { overflow-y: auto; }
    </style>

    <script type="module" src="./js/main.js"></script>
</body>

</html>
