const a="Iv1.8a61f9b3a7aba766",r="http://localhost:47524/callback";class h{constructor(){this.authWindow=null,this.authPromise=null}async authorize(){return new Promise((i,e)=>{this.authWindow&&this.authWindow.close();const n=`https://github.com/login/oauth/authorize?client_id=${a}&redirect_uri=${encodeURIComponent(r)}&scope=repo%20read:user%20user:email%20delete_repo&state=${Date.now()}`;this.authWindow=window.open(n,"GitHub Authorization","width=600,height=700,modal=yes");const o=t=>{t.origin==="http://localhost:47524"&&(t.data.type==="github-oauth-success"?(window.removeEventListener("message",o),this.authWindow&&(this.authWindow.close(),this.authWindow=null),i(t.data.token)):t.data.type==="github-oauth-error"&&(window.removeEventListener("message",o),this.authWindow&&(this.authWindow.close(),this.authWindow=null),e(new Error(t.data.error))))};window.addEventListener("message",o);const s=setInterval(()=>{var t;(t=this.authWindow)!=null&&t.closed&&(clearInterval(s),window.removeEventListener("message",o),e(new Error("Авторизация отменена")))},500)})}async exchangeCodeForToken(i){try{return await window.ipcRenderer.invoke("github-oauth-exchange",i)}catch(e){throw console.error("[OAuth] Exchange error:",e),e}}}const c=new h;export{c as githubOAuth};
